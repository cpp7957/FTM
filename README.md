# Face Overlay Detection (FTM)

이 프로젝트는 실시간 화면 캡쳐, 얼굴 검출, 그리고 선택한 오버레이 이미지(PNG)를 얼굴 영역에 적용하는 애플리케이션입니다. Tkinter 기반의 GUI를 통해 사용자 설정을 쉽게 조정할 수 있으며, OpenCV의 Haar Cascade를 이용해 얼굴을 검출합니다.

## 주요 기능

- **모니터 선택:**  
  mss 라이브러리를 이용해 연결된 모니터 중 원하는 모니터를 선택하여 화면 캡쳐를 진행합니다.

- **오버레이 이미지 로드:**  
  파일 대화 상자를 통해 PNG 형식의 오버레이 이미지를 불러옵니다.  
  오버레이 이미지는 알파 채널(투명도)이 있는 경우 이를 분리하여 얼굴 영역에 자연스럽게 적용합니다.

- **화면 크기 조절:**  
  슬라이더를 이용해 캡쳐한 화면의 크기를 조절할 수 있습니다. (기본 값: 0.5)

- **얼굴 검출 설정:**  
  Haar Cascade 기반 얼굴 검출 시 사용되는 파라미터인 `scaleFactor`와 `minNeighbors` 값을 슬라이더로 조정할 수 있어 검출 정확도 및 민감도를 사용자 환경에 맞게 설정할 수 있습니다. (기본 값: scaleFactor 1.2, minNeighbors 4)

- **FPS 표시:**  
  실시간 처리 속도(FPS)를 화면에 표시할 수 있는 옵션을 제공합니다.

- **종료 키 설정:**  
  사용자가 원하는 ASCII 코드 값(기본값: 27)을 입력하여 얼굴 검출 창을 종료할 수 있습니다.

## 요구 사항

- Python 3.x  
- [OpenCV](https://opencv.org/) (`opencv-python`)  
- [NumPy](https://numpy.org/)  
- [mss](https://python-mss.readthedocs.io/)  
- Tkinter (Python 기본 제공)

## 설치 및 실행

1. **Python 및 라이브러리 설치**  
   Python 3.x가 설치되어 있지 않다면 [Python 공식 사이트](https://www.python.org/downloads/)에서 다운로드 후 설치합니다.  
   터미널(또는 명령 프롬프트)에서 아래 명령어를 실행하여 필요한 라이브러리를 설치합니다:

   ```bash
   pip install opencv-python numpy mss
   ```

2. **리소스 파일 준비**  
   얼굴 검출에 사용되는 Haar Cascade XML 파일인 `haarcascade_frontalface_default.xml`을 코드와 동일한 디렉토리에 위치시키거나, PyInstaller로 실행 파일을 생성할 경우 `resource_path` 함수가 올바른 경로를 처리하도록 합니다.

3. **프로그램 실행**  
   터미널에서 다음 명령어를 입력하여 프로그램을 실행합니다:

   ```bash
   python main.py
   ```

## 사용 방법

1. **GUI 구성 요소**  
   프로그램 실행 시 Tkinter 기반의 GUI 창이 나타납니다.  
   - **모니터 선택:** 드롭다운 메뉴에서 원하는 모니터를 선택합니다.  
   - **오버레이 변경:** 버튼을 눌러 오버레이 이미지(PNG 파일)를 선택합니다.  
   - **화면 크기 조절:** 슬라이더를 이동하여 캡쳐 화면의 크기를 조절합니다.  
   - **얼굴 검출 파라미터 조정:**  
     - `scaleFactor` 슬라이더: 얼굴 검출 시 스케일 증가 비율을 조정합니다.  
     - `minNeighbors` 슬라이더: 검출 민감도를 조정합니다.
   - **FPS 표시:** 체크박스를 통해 실시간 FPS 표시 여부를 설정합니다.  
   - **종료 키 설정:** 텍스트 입력란에 종료를 원하는 ASCII 코드(기본: 27)를 입력합니다.

2. **얼굴 검출 및 오버레이 적용**  
   "실행" 버튼을 클릭하면 선택한 모니터의 화면이 캡쳐되고, 얼굴 검출이 진행됩니다.  
   검출된 얼굴 영역에는 선택한 오버레이 이미지가 알파 블렌딩 방식으로 적용되어 표시됩니다.

3. **종료 방법**  
   캡쳐 및 얼굴 검출 창에서 설정한 종료 키(예: ESC 키, ASCII 27)를 누르면 프로그램이 종료됩니다.

## 코드 구성

- **resource_path 함수:**  
  PyInstaller로 패키징한 실행 파일에서도 리소스(XML 파일)의 경로를 올바르게 설정할 수 있도록 도와줍니다.

- **Haar Cascade 로딩:**  
  `haarcascade_frontalface_default.xml` 파일을 불러와 얼굴 검출기를 초기화하며, 로딩 실패 시 오류 메시지를 출력합니다.

- **load_overlay 함수:**  
  파일 대화 상자를 통해 PNG 오버레이 이미지를 선택하고, 알파 채널과 RGB 채널을 분리하여 전역 변수에 저장합니다.

- **GUI 구성:**  
  Tkinter와 ttk를 이용해 모니터 선택, 슬라이더, 체크박스, 버튼 등의 다양한 인터페이스 요소를 구성합니다.

- **run_detection 함수:**  
  - mss로 선택된 모니터의 화면을 캡쳐합니다.  
  - 캡쳐된 이미지에 대해 크기 조절, 흑백 변환, 얼굴 검출을 진행합니다.  
  - 검출된 얼굴 영역에 오버레이 이미지를 알파 블렌딩 방식으로 적용합니다.  
  - 설정에 따라 FPS를 표시하고, 결과 이미지를 OpenCV 창에 출력합니다.  
  - 사용자가 설정한 종료 키를 누르면 캡쳐 루프를 종료합니다.

## 참고 사항

- **PyInstaller 사용:**  
  PyInstaller로 프로그램을 패키징할 경우, `resource_path` 함수가 리소스 파일의 경로 문제를 해결합니다.

- **오버레이 이미지:**  
  오버레이로 사용할 PNG 파일은 알파 채널(투명도 정보)을 포함해야 자연스러운 오버레이 효과를 얻을 수 있습니다.

- **오류 처리:**  
  오버레이 이미지가 로드되지 않거나 XML 파일 로드에 실패할 경우, 콘솔에 오류 메시지가 출력됩니다.

## 라이센스

이 프로젝트는 MIT 라이센스에 따라 배포됩니다.
